var t={};t=class{constructor(t=this.initializeBoard()){this.inicialState=t,this.state=this.inicialState.map(t=>[...t]),this.futureState=[],this.score=0,this.status="idle",this.startGame=!1}initializeBoard(){let t=[];for(let e=0;e<4;e++)t.push([,,,,].fill(0));return t}isEqual(t,e){for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)if(t[s][i]!==e[s][i])return!1;return!0}moveLeft(){if(this.startGame){for(let t=0;t<4;t++){let e=[...this.state[t]];e=this.slide(e),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveRight(){if(this.startGame){for(let t=0;t<4;t++){let e=[...this.state[t]];e.reverse(),(e=this.slide(e)).reverse(),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveUp(){if(this.startGame){this.futureState=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e=this.slide(e);for(let s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveDown(){if(this.startGame){this.futureState=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e.reverse(),(e=this.slide(e)).reverse();for(let s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}getScore(){return this.score}getState(){return this.state.map(t=>[...t])}getStatus(){return this.status}setBestScore(t,e){(null===e||e<t)&&localStorage.setItem("user",t)}getBestScore(){let t=localStorage.getItem("user");return null===t?0:t}start(){this.status="playing",this.startGame=!0,this.state=this.inicialState.map(t=>[...t]),this.score=0,this.setTwo(),this.setTwo()}restart(){this.status="idle",this.startGame=!1,this.state=this.inicialState.map(t=>[...t]),this.score=0}slide(t){let e=this.filterZero(t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}filterZero(t){return t.filter(t=>0!==t)}updateTile(t,e){t.innerText="",t.classList.value="",t.classList.add("field__cell"),e>0&&(t.innerText=e,t.classList.add("field__cell--"+e.toString()))}updateScore(t){t.innerText=this.score}setTwo(){if(!this.hasEmptyTile())return;let t=!1;for(;!t;){let e=Math.floor(4*Math.random()),s=Math.floor(4*Math.random());if(0===this.state[e][s]){let i=.9>Math.random()?2:4;this.state[e][s]=i,t=!0}}}hasEmptyTile(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.state[t][e])return!0;return!1}isWin(t){t.forEach(t=>{t.forEach(t=>{2048===t&&(this.status="win")})})}isLose(){for(let t of this.state){if(t.some(t=>0===t))return!1;for(let e=0;e<t.length;e++)if(t[e]===t[e+1])return!1}for(let t=0;t<4;t++){let e=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];for(let t=0;t<e.length;t++)if(e[t]===e[t+1])return!1}return!0}};const e={score:document.querySelector('[data-score="score"]'),best:document.querySelector('[data-best="best"]'),rows:document.querySelectorAll(".field__cell"),start:document.querySelector(".button"),field:document.querySelector(".game__field"),messageWin:document.querySelector(".message__content--win"),messageLose:document.querySelector(".message__content--lose"),messageStart:document.querySelector(".message__content--start")};let s=0;const i=new t;function r(){for(let t=0;t<4;t++)for(let s=0;s<4;s++){let r=document.getElementById(`${t}-${s}`),a=i.getState()[t][s];i.updateTile(r,a),e.best.innerText=i.getBestScore()}}e.score&&(e.score.innerText=i.getScore()),e.best&&(e.best.innerText=i.getBestScore()),r(),e.start.addEventListener("click",()=>{"Start"===e.start.textContent&&(i.start(),r(),i.updateScore(e.score),e.messageStart.classList.add("hidden")),"Restart"===e.start.textContent&&("win"===i.getStatus()&&e.messageWin.classList.add("hidden"),"lose"===i.getStatus()&&e.messageLose.classList.add("hidden"),i.restart(),e.start.innerText="Start",e.start.classList.add("start"),e.start.classList.remove("restart"),s=0,r(),i.updateScore(e.score),e.messageStart.classList.remove("hidden"))}),document.addEventListener("keydown",t=>{("ArrowUp"===t.key||"ArrowDown"===t.key)&&t.preventDefault()}),document.addEventListener("keyup",t=>{switch(i.getStatus()){case"playing":switch(t.code){case"ArrowLeft":i.moveLeft();break;case"ArrowRight":i.moveRight();break;case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown()}r(),s++;break;case"win":e.messageWin.classList.remove("hidden");break;case"lose":e.messageLose.classList.remove("hidden")}i.updateScore(e.score);let a=window.localStorage.getItem("user");i.setBestScore(i.getScore(),a),s>=1&&(e.start.innerText="Restart",e.start.classList.remove("start"),e.start.classList.add("restart"))});
//# sourceMappingURL=index.62c77362.js.map
